{
    "contents" : "%\\VignetteIndexEntry{testerccdashboard examples}\n\n\\documentclass{article}\n\\usepackage{fullpage}\n\\begin{document}\n\\SweaveOpts{concordance=TRUE}\n\\SweaveOpts{keep.source=TRUE}\n\\SweaveOpts{width=7, height=7}\n\\DefineVerbatimEnvironment{Sinput}{Verbatim} {xleftmargin=1em}\n\\DefineVerbatimEnvironment{Soutput}{Verbatim}{xleftmargin=1em}\n\\DefineVerbatimEnvironment{Scode}{Verbatim}{xleftmargin=1em}\n\\fvset{listparameters={\\setlength{\\topsep}{0pt}}}\n\\renewenvironment{Schunk}{\\vspace{\\topsep}}{\\vspace{\\topsep}}\n<<echo=false>>=\noptions(width=60, continue = \"  \")\n#options(SweaveHooks=list(fig=function()\n#                par(mar=c(5.1,4.1,1.1,2.1))))\n@    \n\\title{{\\tt erccdashboard} Package Vignette}\n\\author{Sarah A. Munro}\n\\maketitle\n\nThis vignette describes the use of the erccdashboard R package to analyze \nExternal RNA Control Consortium (ERCC) spike-in control ratio mixtures in gene\nexpression experiments. Two types of data from the SEQC/MAQC III project were \nanalyzed.\n\\begin{enumerate}\n  \\item Rat toxicogenomics treatment and control samples for different drug \n  treatments\n  \\item Human reference RNA samples from the MAQC I project, Universal Human \n  Reference RNA (UHRR) and Human Brain Reference RNA (HBRR)\n\\end{enumerate}\n\n\\section{Rat Toxicogenomics Example: MET treatment}\n\\subsection{Load data and define input parameters}\nLoad the testerccdashboard package. \n<<initializeData,results=hide,echo=TRUE>>=\nlibrary( \"erccdashboard\" )\n@\nLoad the Rat Toxicogenomics Data set.\n<<loadRatData>>=\nload(file = system.file(\"data/SEQC.RatTox.Example.RData\", \n                        package = \"erccdashboard\"))\n@\nThe R workspace should now contain 5 count tables and for each count table a \ncorresponding total reads vector.\nTake a look at the data for the MET experiment.\n<<inspectRatData,keep.source=TRUE>>=\nhead(COH.RatTox.ILM.MET.CTL.countTable)\nCOH.RatTox.ILM.MET.CTL.totalReads\n@\nThe first column of the count table, Feature, contains unique names for all\nthe transcripts that were quantified in this experiment. The remaining columns \nrepresent replicates of the pair of samples, in this count table \nthe control sample is labeled CTL and the treatment sample is labeled MET. An \nunderscore is included to separate the sample names from the replicate numbers \nduring analysis. This naming convention Sample\\textunderscore{}Rep is needed \nfor the columns of any input count table.\n\nThe total reads vectors will be used for library size normalization of the count\ntables. Total reads can either represent the total number of reads in FASTQ \nfiles or total mapped reads. In the examples provided with this package FASTQ \nfile total reads are used.\n\nFor our analysis of the MET-CTL experiment start by assigning the MET-CTL data \nto the input data variables countTable and totalReads.\n<<defineInputData,keep.source=TRUE>>=\ncountTable <- COH.RatTox.ILM.MET.CTL.countTable\ntotalReads <- COH.RatTox.ILM.MET.CTL.totalReads\n@\nIn addition to countTable and totalReads, there are 7 additional variables that\nmust be defined by the user. First the filename prefix for results files, \nfilenameRoot, needs to be defined. Here we choose to use the lab abbreviation \nCOH and the platform abbreviation ILM as our identifiers, but this is flexible\nfor the user.\n<<definefileRoot,keep.source=TRUE>>=\nfilenameRoot = \"COH.ILM\"\n@\nNext, 6 parameters associated with the ERCC control ratio mixtures need to be\ndefined, sample1Name, sample2Name, erccMixes, ERCCdilution, spikeVol, and totalRNAmass.\n\nThe sample spiked with ERCC Mix 1 is sample1Name and the sample spiked with \nERCC Mix 2 is sample2Name. In this experiment sample1Name = MET and \nsample2Name = CTL. For a more robust experimental design the reverse spike-in \ndesign could be created using additional replicates of the treatment and \ncontrol samples. ERCC Mix 2 would be spiked into MET samples and ERCC Mix 1 \nwould be spiked into CTL control replicates. \n\nERCCdilution is the dilution factor of the pure Ambion ERCC mixes prior to \nspiking into total RNA samples. Here a 1/100 dilution was made from the Ambion \nERCC mixes according to the protocol. The amount of diluted ERCC mix spiked into\nthe total RNA sample is spikeVol (units are $\\mu$L). The mass of total RNA \nspiked with the diluted ERCC mix is totalRNAmass (units are $\\mu$g ).\n<<defineInputSpikes,keep.source=TRUE>>=\nsample1Name = \"MET\"\nsample2Name = \"CTL\"\nERCCMixes = \"Ambion4plexPair\"\nERCCdilution = 1/100\nspikeVol = 1\ntotalRNAmass = 0.500\n@\nThe final required input parameter, choseFDR, is the False Discovery Rate (FDR) \nfor differential expression testing. A typical choice would be 0.05 (5\\% FDR), \nfor the rat data sets a more liberal FDR was used, choseFDR = 0.1.\n<<defineFDR,keep.source=TRUE>>=\nchoseFDR = 0.1\n@\nIn addition to the required input variables the user can also choose whether to \nprint the results directly to a PDF file (the default is TRUE) with the variable\nprintPDF.\n\n\\subsection{Initialize the expDat list for analysis}\nThe expDat list is created with the initDat function:\n<<initializeData,keep.source=TRUE>>=\nexpDat <- initDat(countTable, totalReads, filenameRoot, sample1Name,\n                  sample2Name, ERCCMixes, ERCCdilution, spikeVol, totalRNAmass,\n                  choseFDR)\n@\nLook at the structure of expDat\n<<initializeData,keep.source=TRUE>>=\nsummary(expDat)\n@\nThe expDat list will be passed to the erccdashboard functions for analysis of \ntechnical performance.\n\n\\subsection{Estimate the mRNA fraction difference, r$_m$ for the pair of \nsamples}\nEstimate r$_m$ for the sample pair using a negative binomial glm. The r$_m$ \nresults will be added to the expDat structure and are necessary for the \nremaining analysis.\n\\begin{center}\n<<est_r_m>>=\nexpDat <- est_r_m(expDat)\n@\n\\end{center}\nAn r$_m$ of 1 indicates that the two sample types under comparison have similar\nmRNA fractions of total RNA. The r$_m$ estimate is used to adjusted the expected\nERCC mixture ratios in this analysis and may indicate a need for a different\nsample normalization approach.\n\n\\subsection{Test for differential expression}\nTest for differential expression with the geneExprTest function. This function\nwraps the QuasiSeq differential expression testing package. If a correctly\nformatted csv file is provided with the necessary DE test results, then \ngeneExprTest will bypass DE testing (with reduced runtime). The function will\nlook for a csv file with the name \"filenameRoot.quasiSeq.res.csv\" and the first\n3 column headers of the file must be \"Feature\", \"pvals\", and \"qvals\".\n\\begin{center}\n<<geneExprTest,results=hide>>=\nexpDat <- geneExprTest(expDat)\n@\n\\end{center}\n\n\\subsection{Diagnostic Performance: ROC curves and AUC statistics}\nGenerate ROC curves for the differential ratios and the corresponding Area Under\nthe Curve (AUC) statistics.\n\\begin{center}\n<<erccROC>>=\nexpDat = erccROC(expDat)\n@\n\\end{center}\n\n\\subsection{Diagnostic Performance: Limit of Detection of Ratios (LODR)}\nFind LODR estimates using the ERCC data p-values.\n\\begin{center}\n<<estLODRERCC>>=\nexpDat = estLODR(expDat,kind = \"ERCC\", prob=0.9)\n@\n\\end{center}\n\n\nOne can also obtain LODR estimates using p-values simulated from endogenous transcripts\n\\begin{center}\n<<estLODRSim>>=\nexpDat = estLODR(expDat, kind = \"Sim\", prob = 0.9)  \n@\n\\end{center}\n\n\\subsection{Use dynRangePlot function to evaluate dynamic range of the data}\nThis function will add a plot to \\verb|expDat$Figures|\nof the signal vs. abundance of the spiked ERCC controls.\n\\begin{center}\n<<dynRangeDat>>=\nexpDat <- dynRangePlot(expDat, errorBars = T)\n@\n\\end{center}\nView the plot that is now stored in expDat with the command\n\\clearpage\n\\begin{center}\n<<printPanelD,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotdynRange\n@\n\\end{center}\nThis figure shows that in this experiment the expected signal-abundance\nrelationship spans a 2$^{15}$ dynamic range. To capture the full 2$^{20}$ dynamic \nrange design of the control mixtures additional sequencing depth may be needed.\n\n\\subsection{Use LODR estimates to Annotate Signal-Abundance and Ratio-Abundance Plots}\nGet LODR annotations for adding to plots and then annotate the signal-abundance\nand ratio-abundance plots using LODR estimate information \n\n<<dynRangeLODRAnnot>>=\nexpDat <- annotLODR(expDat)\n@\n\\clearpage\n\\subsection{Viewing Diagnostic Plots}\nAll dashboard plots are stored in the \\verb|expDat$Figures|\nlist. You can call any figure for viewing directly and you can \nalso save the figures to a pdf file. The six plots presented in the \nerccdashboard publication can be generated with the following commands.\n\\begin{center}\n<<printPanelA,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$ROCplot\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelB,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotLODR.ERCC\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelC,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$dispPlot\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelD,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotdynRangeAnnot\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelE,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotERCCeffects\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelF,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotRatioAnnot\n@\n\\end{center}\n\\clearpage\nThe function savePlots will save selected figures to a pdf file. The default is\nthe 6 manuscript figures to a single page (plotsPerPg = ``''manuscript``''). If \nplotsPerPg = ``''single``'' then each plot is placed on an individual page in one pdf \nfile. If plotlist is not defined (plotlist = NULL) then all plots in \n\\verb|expDat$Figures| are printed to the file.\n<<savePlots>>=\nsavePlots(expDat)\n@\n\n\\subsection{Output Results for Comparisons Across Experiments or Between \nLaboratories}\nIf you wish, save your results to an Rdata file that can be reused for\ncomparisons across experiments or between laboratories.\n<<saveResults>>=\nsaveResults(expDat)\n@\n\n\\section{SEQC Reference RNA Examples: UHRR vs. HBRR}\n\\subsection{Load data and define input parameters}\n<<defineMainStudyInputs, keep.source=TRUE>>=\nload(file = system.file(\"data/SEQC.Main.Example.RData\", \n                        package = \"erccdashboard\"))\ncountTable <- Lab5.ILM.UHRR.HBRR.countTable\ntotalReads <- Lab5.ILM.UHRR.HBRR.totalReads\nfilenameRoot = \"Lab5\"\nsample1Name = \"UHRR\"\nsample2Name = \"HBRR\"\nERCCMixes = \"Ambion4plexPair\"\nERCCdilution = 1\nspikeVol = 50\ntotalRNAmass = 2.5*10^(3)\nchoseFDR = 0.1\nexpDat <- initDat(countTable, totalReads, filenameRoot, sample1Name,\n                  sample2Name, ERCCMixes, ERCCdilution, spikeVol, totalRNAmass,\n                  choseFDR)\n@\n\n<<est_r_m>>=\nexpDat <- est_r_m(expDat)\n@\n\n<<geneExprTest, results=hide>>=\nexpDat <- geneExprTest(expDat)\n@\n\n\\subsection{Diagnostic Performance: ROC curves and AUC statistics}\nGenerate ROC curves for the differential ratios and the corresponding Area Under\nthe Curve (AUC) statistics.\n\\begin{center}\n<<erccROC>>=\nexpDat = erccROC(expDat)\n@\n\\end{center}\n\n\\subsection{Diagnostic Performance: Limit of Detection of Ratios (LODR)}\nFind LODR estimates using the ERCC data p-values.\n\\begin{center}\n<<estLODRERCC>>=\nexpDat = estLODR(expDat,kind = \"ERCC\", prob=0.9)\n@\n\\end{center}\n\n\nOne can also obtain LODR estimates using p-values simulated from endogenous transcripts\n\\begin{center}\n<<estLODRSim>>=\nexpDat = estLODR(expDat, kind = \"Sim\", prob = 0.9)  \n@\n\\end{center}\n\n\\subsection{Use dynRangePlot function to evaluate dynamic range of the data}\nThis function will add a plot to \\verb|expDat$Figures|\nof the signal vs. abundance of the spiked ERCC controls.\n\\begin{center}\n<<dynRangeDat>>=\nexpDat <- dynRangePlot(expDat,errorBars=T)\n@\n\\end{center}\nView the plot that is now stored in expDat with the command\n\\clearpage\n\\begin{center}\n<<printPanelD,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotdynRange\n@\n\\end{center}\nThis figure shows that in this experiment the expected signal-abundance\nrelationship spans the full 2$^{20}$ dynamic range design of the control mixtures.\n\n\\subsection{Use LODR estimates to Annotate Signal-Abundance and Ratio-Abundance Plots}\nGet LODR annotations for adding to plots and then annotate the signal-abundance\nand ratio-abundance plots using LODR estimate information \n\n<<dynRangeLODRAnnot>>=\nexpDat <- annotLODR(expDat)\n@\n\\clearpage\n\\subsection{Viewing Diagnostic Plots}\nAll dashboard plots are stored in the \\verb|expDat$Figures|\nlist. You can call any figure for viewing directly and you can \nalso save the figures to a pdf file. The six plots presented in the \nerccdashboard publication can be generated with the following commands.\n\\begin{center}\n<<printPanelASEQC,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$ROCplot\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelBSEQC,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotLODR.ERCC\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelCSEQC,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$dispPlot\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelDSEQC,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotdynRangeAnnot\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelESEQC,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotERCCeffects\n@\n\\end{center}\n\\clearpage\n\\begin{center}\n<<printPanelFSEQC,fig=TRUE,pdf=TRUE>>=\nexpDat$Figures$plotRatioAnnot\n@\n\\end{center}\n\\clearpage\nThe function savePlots will save selected figures to a pdf file. The default is\nthe 6 manuscript figures to a single page (plotsPerPg = ``''manuscript``''). If \nplotsPerPg = ``''single``'' then each plot is placed on an individual page in one pdf \nfile. If plotlist is not defined (plotlist = NULL) then all plots in \n\\verb|expDat$Figures| are printed to the file.\n<<savePlots>>=\nsavePlots(expDat)\n@\n\n\\subsection{Output Results for Comparisons Across Experiments or Between \nLaboratories}\nIf you wish, save your results to an Rdata file that can be reused for\ncomparisons across experiments or between laboratories.\n<<saveResults>>=\nsaveResults(expDat)\n@\n\\end{document}",
    "created" : 1386982228197.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "115558423",
    "id" : "1634EBC5",
    "lastKnownWriteTime" : 1387163201,
    "path" : "~/Documents/NISTMunro/Projects/erccdashboard/inst/doc/erccdashboardVignette.Rnw",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "sweave"
}