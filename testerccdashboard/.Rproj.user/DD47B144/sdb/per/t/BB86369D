{
    "contents" : "##############################################################################\n# Analysis of per site results from SEQC from a given analysis pipeline\n##############################################################################\n# Get required libraries\nlibrary(ggplot2)\nlibrary(reshape2)\nlibrary(plyr)\nlibrary(scales)\nlibrary(edgeR)\nlibrary(locfit)\nlibrary(QuasiSeq)\nlibrary(grid)\nlibrary(stringr)\n\n# Source package scripts\nsource(\"R/initDat.R\") # combine technical replicates\nsource(\"R/sumTechReps.R\") # combine technical replicates\nsource(\"R/getDesignMat.R\") # build factor matrix from sample names\nsource(\"R/dynRangePlot.R\") # dose response curve for dynamic range\nsource(\"R/dynRangePlotLODR.R\") # plot dyn Range with LODR\nsource(\"R/estLODR.R\") # estimate LODR\nsource(\"R/est_r_m.R\") # estimate r_m\nsource(\"R/loadERCCInfo.R\") # load ERCC definition files\nsource(\"R/loadExpMeas.R\") # load expression measures from file\nsource(\"R/maConcPlot.R\") # MA plot coded with LODR\nsource(\"R/multiplot.R\") # plot multiple plots on the same page\nsource(\"R/printLODRres.R\") # print LODR results table\nsource(\"R/QL.results.R\")# load the updated QL.results function for QuasiSeq \nsource(\"R/erccROC.R\") # ROC Plot\nsource(\"R/testDE.R\") # test for DE, obtain p and q values\nsource(\"R/dashboardPDF.R\") #\nsource(\"R/prepERCCDat.R\") #\nsource(\"R/libeSizeNorm.R\")\nsource(\"R/estMnLibeFactor.R\")\nsource(\"R/meltExpDat.R\")\nsource(\"R/geneExprTest.R\")\nsource(\"R/printLODRres.R\")\nsource(\"R/saveResults.R\")\n\n\n###############################################################################\n# Initialize expDat list\n###############################################################################\n# Input parameter adjustments\n# expDat <- initDat(designFactors = c(\"Study\",\"Platform\",\"Site\",\"Sample\",\n#                                     \"Library\"),siteName = \"Lab5\", \n#                   platform = \"LIF\", sample1Name = \"UHRR\", sample2Name = \"HBRR\",\n#                   choseFDR = 0.01, ERCCdilution = 1, spikeVol = 50, \n#                   totalRNAmass = 2.5*10^(3),  \n#                   printPDF = T, DEtest = T,\n#                   totalSeqReads = T, libeSizeNorm = T, myYLimMA = c(-3.5,3.5),\n#                   myXLim = c(-10,15),myYLim = NULL, filenameRoot = NULL)\n# siteName choices are \"Lab1\" to \"Lab6\" platform = \"ILM\", analysis = \"NCTR\" \n# siteName choices are \"Lab7\" to \"Lab9\" platform = \"LIF\", analysis = \"NIST\"\n\n# expDat <- initDat(study = \"SEQC_RatTox\", siteName = \"COH\", platform = \"ILM\",\n#                   analysis = \"RatTox\", sample1Name = \"NIT\", sample2Name = \"CTL\",\n#                   choseFDR = 0.1, ERCCdilution = 1/100, spikeVol = 1, \n#                   totalRNAmass = 0.500, filenameRoot = \"myFilenameIsGood\", \n#                   printPDF = F, DEtest = T,\n#                   totalSeqReads = T, libeSizeNorm = T, myYLimMA = c(-3.5,3.5),\n#                   myXLim = c(-10,15),myYLim = NULL)\n# sample1Name choices are \"NAP\",\"THI\",\"NIT\",\"MET\", & \"3ME\"\n\n# ERCC dilution = the dilution of the Ambion ERCC mixes prior to spiking, if no \n# dilution was performed then ERCCdilution = 1\n# spikeVol = the amount of diluted ERCC mix spiked into the total RNA sample, \n# units are in microliters\n# totalRNAmass = mass of total RNA spiked with the diluted ERCC mix, \n# units are in micrograms\n###############################################################################\n# expDat <- initDat(designFactors = c(\"Study\",\"Platform\",\"Site\",\"Sample\",\n#                                     \"Library\"),siteName = \"Lab5\", \n#                   platform = \"LIF\", sample1Name = \"UHRR\", sample2Name=\"HBRR\",\n#                   choseFDR = 0.01, ERCCdilution = 1, spikeVol = 50, \n#                   totalRNAmass = 2.5*10^(3),  \n#                   printPDF = T, DEtest = T,\n#                   totalSeqReads = T, libeSizeNorm = T, myYLimMA = c(-3.5,3.5),\n#                   myXLim = c(-10,15),myYLim = NULL, filenameRoot = NULL)\ncountTable = COH.RatTox.ILM.MET.CTL.countTable\ntotalReads = COH.RatTox.ILM.MET.CTL.totalReads\nsample1Name = \"MET\"\nsample2Name = \"CTL\"\nfilenameRoot = \"COH.ILM\"\nERCCdilution = 1/100\nspikeVol = 1\ntotalRNAmass = 0.500 \nchoseFDR = 0.1\n\n\n\n# expDat <- initDat(countTable, totalReads, sample1Name, sample2Name,\n#                   filenameRoot, ERCCdilution, spikeVol, totalRNAmass, choseFDR,\n#                   DEtest = T, printPDF = T, erccMixes = \"Ambion4plexPair\",\n#                   totalSeqReads = T, libeSizeNorm = T, \n#                   myYLimMA = c(-3.5,3.5), myXLim = c(-10,15), myYLim = NULL)\nexpDat <- initDat(countTable, totalReads, filenameRoot, sample1Name, \n                  sample2Name, ERCCdilution, spikeVol, totalRNAmass, choseFDR,\n                  printPDF = F)\n\n###############################################################################\n### Estimate r_m for the sample pair using a negative binomial glm\n#expDat <- est_r_m(expDat, cnt = expDat$expressDatSumNoNorm, printPlot = T)\nexpDat <- est_r_m(expDat, cnt = expDat$Transcripts, printPlot = T)\n\n\n###############################################################################\n\n# Test for differential expression if DEtest == T\n# else use existing pvalues of the data in csv files\nexpDat <- geneExprTest(expDat, cnt = expDat$Transcripts,\n                       designMat = expDat$designMat )\n\n###############################################################################\n# Generate ROC curves for the selected differential ratios\nerccROC.res = erccROC(expDat)\n\n\n# Find LODR estimates using the ERCC data pvalues\nlodr.ERCC = estLODR(expDat,kind = \"ERCC\", prob=0.9)\n\n# Find LODR estimates using data pvalues simulated from endogenous transcripts\nlodr.Sim = estLODR(expDat, kind = \"Sim\", prob = 0.9)  \n\n# ###############################################################################\n### Evaluate dynamic range\n#print(\"Signal-Abundance Plots for dynamic range estimation...\")\n\ndynRangeDat = dynRangePlot(expDat, expressDat = expDat$expressDat,\n                           designMat = expDat$designMat, noErrorBars = F)\n\n# Get LODR annotations for adding to plots\nLODR.annot.ERCC <- printLODRres(expDat, dynRangeDat,\n                                lodr.res = lodr.ERCC)\n\n###############################################################################\n# Annotate the dynamic range plots to show how LODR is used to estimate spike \n#  in concentration\ndynRangePlotLODR(dynRangeRes = dynRangeDat$dynRangePlotRes,\n                 LODR.annot.ERCC = LODR.annot.ERCC)\n\n###############################################################################\n\n# Generate MA plots of erccs coded by concentrations from LODR\nmaPlotAB = maConcPlot(expDat, LODR.annot.ERCC, alphaPoint = 0.8, r_mAdjust = T, \n                      replicate = T)\n\n###############################################################################\nsaveResults(expDat, erccROC.res, maPlotAB, lodr.ERCC)\n\n###############################################################################\n### End of Script",
    "created" : 1383945539850.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "605415415",
    "id" : "BB86369D",
    "lastKnownWriteTime" : 1384137586,
    "path" : "~/Documents/NISTMunro/Projects/testerccdashboard/inst/doc/131108_ERCCDashboard_Example.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}